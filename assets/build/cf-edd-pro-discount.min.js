function CFEDDProDiscountField(e,n){function t(){f.parent().find("span").remove()}function o(){if(_.hasOwnProperty("amount")&&_.hasOwnProperty("type")){var e=i(),n=e;return n="percent"==_.type?0==_.amount?e:100==_.amount?0:e-_.amount/100*e:e-_.amount,0>n&&(n=0),n.toFixed(2)}return!1}function r(){_={},t(),h=!0,m.trigger("cf.add"),window.setTimeout(function(){h=!1},100)}function a(){var e=o();!1===e?r():(m.val(e),l.html(e))}function c(){return f.val()}function i(){return parseFloat(m.val())}function s(){if(""==c())return void r();n(document).trigger("cf.edd.cartItems",{self:u,cartItems:d,form:e.form});var t={total:i(),code:c(),nonce:e.nonce,form:e.form,items:d};e.hasOwnProperty("rest_nonce")&&""!=e.rest_nonce&&(t.rest_nonce=e.rest_nonce),n.ajax({url:e.url,data:t,success:function(e,n,t){e.hasOwnProperty("amount")&&e.hasOwnProperty("type")?(_.amount=e.amount,_.type=e.type,u.report(e.message,!1),a()):r()},error:function(e,n,t){r(),e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("message")?u.report(e.responseJSON.message,!0):u.report("Error",!0)}})}var d,u=this,f=n(document.getElementById(e.id_attr)),p=n("form#"+e.form+"_"+e.form_count),m=p.find('[data-field="'+e.price_field+'"]'),l=p.find("#"+e.price_field+"_"+e.form_count),_={},h=!1;this.fieldChange=function(){s()},this.priceChange=function(){!1===h&&a()},f.on("change",u.fieldChange),m.on("change",u.priceChange),this.setCartItems=function(e){d=e},this.report=function(e,o){t();var r=f.parent(),a="help-block";a+=o?" alert alert-danger  caldera_ajax_error_block":" alert alert-success";var c=n("<span>",{class:a});c.html(e),r.append(c)},this.setWPNonce=function(n){e.rest_nonce=n},this.setNonce=function(n){e.nonce=n}}jQuery(function(e){var n=e("input[data-edd-discount]");n.length&&(void 0==window.cf_edd_pro_discount&&(window.cf_edd_pro_discount={}),n.each(function(n,t){window.cf_edd_pro_discount[t]=new CFEDDProDiscountField(e(t).data("edd-discount"),e)})),e(document).on("cf.edd.cartItems",function(e,n){var t,o=n.form;void 0!=window.cf_edd_pro&&void 0!=window.cf_edd_pro[o]&&(t=window.cf_edd_pro[o].getDownloads(),t.length?n.self.setCartItems(t):n.self.setCartItems([]))})});