function CFEDDProDiscountField(e,t){function n(){f.parent().find("span").remove()}function r(){if(h.hasOwnProperty("amount")&&h.hasOwnProperty("type")){var e=i(),t=e;return t="percent"==h.type?0==h.amount?e:100==h.amount?0:e-h.amount/100*e:e-h.amount,0>t&&(t=0),t.toFixed(2)}return!1}function o(){h={},n(),g=!0,m.trigger("cf.add"),window.setTimeout(function(){g=!1},100)}function a(){var e=r();!1===e?o():(m.val(e),l.html(e))}function c(){return f.val()}function i(){return parseFloat(m.val())}function s(){if(""==c())return void o();t(document).trigger("cf.edd.cartItems",{self:u,cartItems:d,form:e.form}),t.ajax({url:e.url,data:{total:i(),code:c(),nonce:e.nonce,_wpnonce:e.rest_nonce,form:e.form,items:d},success:function(e,t,n){e.hasOwnProperty("amount")&&e.hasOwnProperty("type")?(h.amount=e.amount,h.type=e.type,u.report(e.message,!1),a()):o()},error:function(e,t,n){o(),e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("message")?u.report(e.responseJSON.message,!0):u.report("Error",!0)}})}var d,u=this,f=t(document.getElementById(e.id_attr)),p=t("form#"+e.form+"_"+e.form_count),m=p.find('[data-field="'+e.price_field+'"]'),l=p.find("#"+e.price_field+"_"+e.form_count),h={},g=!1;this.fieldChange=function(){s()},this.priceChange=function(){!1===g&&a()},f.on("change",u.fieldChange),m.on("change",u.priceChange),this.setCartItems=function(e){d=e},this.report=function(e,r){n();var o=f.parent(),a="help-block";a+=r?" alert alert-danger  caldera_ajax_error_block":" alert alert-success";var c=t("<span>",{class:a});c.html(e),o.append(c)}}jQuery(function(e){var t=e("input[data-edd-discount]");t.length&&t.each(function(t,n){new CFEDDProDiscountField(e(n).data("edd-discount"),e)}),e(document).on("cf.edd.cartItems",function(e,t){var n,r=t.form;void 0!=window.cf_edd_pro&&void 0!=window.cf_edd_pro[r]&&(n=window.cf_edd_pro[r].getDownloads(),n.length?t.self.setCartItems(n):t.self.setCartItems([]))})});